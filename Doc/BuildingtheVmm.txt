Building the VMM
================


The VMM which is a derivative of eVMM donated by Intel compiles under Linux
an, like the custom Linux for CloudProxy and the CloudProxy enabled KVM,
can be Tbooted.

The code is in FILEPROXY/cpvmm, where FILEPROXY is the root of the Cloudproxy
source repository.

Instructions to compile
-----------------------

Make a object directory ROOT/vmmobjects.  ROOT is the directory in which executables
will be placed.  On my machine it is /home/jlm/jlmcrypt.

1. Export the directory names you use for the source and executable
	export CPProgramDirectory=/home/jlm/jlmcrypt
	export VMSourceDirectory=/home/jlm/fpDev/fileProxy/cpvmm

2.  Make the object directories.
	mkdir $(CPProgramDirectory)/vmmobjects
	mkdir $(CPProgramDirectory)/vmmobjects/acpi  
	mkdir $(CPProgramDirectory)/vmmobjects/dbg    
	mkdir $(CPProgramDirectory)/vmmobjects/host  
	mkdir $(CPProgramDirectory)/vmmobjects/host/hw
	mkdir $(CPProgramDirectory)/vmmobjects/host/hw/em64t
	mkdir $(CPProgramDirectory)/vmmobjects/libc    
	mkdir $(CPProgramDirectory)/vmmobjects/startup  
	mkdir $(CPProgramDirectory)/vmmobjects/vmexit  
	mkdir $(CPProgramDirectory)/vmmobjects/vmx
	mkdir $(CPProgramDirectory)/vmmobjects/arch  
	mkdir $(CPProgramDirectory)/vmmobjects/guest  
	mkdir $(CPProgramDirectory)/vmmobjects/guest/guest_cpu
	mkdir $(CPProgramDirectory)/vmmobjects/guest/scheduler
	mkdir $(CPProgramDirectory)/vmmobjects/ipc   
	mkdir $(CPProgramDirectory)/vmmobjects/memory  
	mkdir $(CPProgramDirectory)/vmmobjects/memory/ept
	mkdir $(CPProgramDirectory)/vmmobjects/memory/memory_manager
	mkdir $(CPProgramDirectory)/vmmobjects/utils    
	mkdir $(CPProgramDirectory)/vmmobjects/vmm

3. Build
	cd $(VMSourceDirectory)/vmm
	make -f vmm.mak


Unlike Linux, which expects to be called by tboot in main on the bootstrap processor,
evmm expects to be called on all processors by tboot in vmm_main with different argument
list than main has in Linux so tboot needs to be modified.




